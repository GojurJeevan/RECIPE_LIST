var should = require('should');
var CloudSearchClient = require('../../lib/client');
var config = require('../config');

describe('client', function () {
  var client;
  before(function () {
    client = new CloudSearchClient(config.clientId, config.clientSecret, config.apiUrl);
  });

  it('search', function (done) {
    client.search('beauty', {q: '女装'}, function (err, data) {
      should.not.exist(err);
      (typeof data).should.eql('object');
      data.should.have.property('status', 'OK');
      done();
    });
  });
  
  it('search', function (done) {
    var queryParams = {
      filter: 'seller_id=357581721',
      sort: '-reserve_price',
      page: 1,
      page_size: 5
    };
    client.search('beauty', queryParams, function (err, data) {
      should.not.exist(err);
      (typeof data).should.eql('object');
      data.should.have.property('status', 'OK');
      done();
    });
  });

  // { result: 
  //  { searchtime: 0.136,
  //    total: 14,
  //    num: 5,
  //    viewtotal: 14,
  //    items: [ [Object], [Object], [Object], [Object], [Object] ] },
  // status: 'OK' }
  it('search multi filter', function (done) {
    var queryParams = { 
      filter: 'seller_id=770469435 AND category_level=2 AND category_level1=30 AND category_level2=50000436',
      sort: '-reserve_price',
      page: 1,
      page_size: 5 
    };
    client.search('beauty', queryParams, function (err, data) {
      should.not.exist(err);
      (typeof data).should.eql('object');
      data.should.have.property('status', 'OK');
      data.should.have.property('result');
      data.result.items.length.should.above(0);
      done();
    });
  });


  it('listIndexes', function (done) {
    client.listIndexes(function (err, data) {
      should.not.exist(err);
      (typeof data).should.eql('object');
      data.should.have.property('status', 'OK');
      data.should.have.property('total');
      parseInt(data.total).should.above(0);
      done();
    });
  });

  it('listIndexes with null params', function (done) {
    client.listIndexes(null, null, function (err, data) {
      should.not.exist(err);
      (typeof data).should.eql('object');
      data.should.have.property('status', 'OK');
      data.should.have.property('total');
      parseInt(data.total).should.above(0);
      done();
    });
  });



});